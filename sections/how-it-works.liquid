{{ 'section-how-it-works.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<div class="how-it-works color-{{ section.settings.color_scheme }} gradient">
  <div class="page-width section-{{ section.id }}-padding">
    {%- if section.settings.heading != blank -%}
      <div class="how-it-works__header{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
        <h2 class="how-it-works__title {{ section.settings.heading_size }}">
          {{ section.settings.heading }}
        </h2>
        {%- if section.settings.subheading != blank -%}
          <p class="how-it-works__subtitle">
            {{ section.settings.subheading }}
          </p>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="how-it-works__steps how-it-works__steps--{{ section.blocks.size }}-items">
      {%- for block in section.blocks -%}
        <div
          class="how-it-works__step{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
          {{ block.shopify_attributes }}
          {% if settings.animations_reveal_on_scroll %}
            style="--animation-order: {{ forloop.index }};"
          {% endif %}
        >
          <div class="how-it-works__step-number">{{ forloop.index }}</div>

          {%- if block.settings.image != blank -%}
            <div class="how-it-works__step-image">
              {{
                block.settings.image
                | image_url: width: 600
                | image_tag:
                  widths: '200, 300, 400, 600',
                  sizes: '(min-width: 990px) 20vw, (min-width: 750px) 25vw, 70vw',
                  class: 'how-it-works__image',
                  loading: 'lazy'
              }}
            </div>
          {%- elsif block.settings.video_url != blank -%}
            <div class="how-it-works__step-video">
              <video
                autoplay
                muted
                loop
                playsinline
                class="how-it-works__video"
              >
                <source src="{{ block.settings.video_url }}" type="video/mp4">
              </video>
            </div>
          {%- else -%}
            <div class="how-it-works__step-icon" style="background-color: {{ block.settings.icon_color }}">
              {%- if block.settings.icon == 'upload' -%}
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
              {%- elsif block.settings.icon == 'design' -%}
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>
              {%- elsif block.settings.icon == 'print' -%}
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
              {%- elsif block.settings.icon == 'ship' -%}
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
              {%- else -%}
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
              {%- endif -%}
            </div>
          {%- endif -%}

          <h3 class="how-it-works__step-title">{{ block.settings.title }}</h3>

          {%- if block.settings.description != blank -%}
            <div class="how-it-works__step-description rte">
              {{ block.settings.description }}
            </div>
          {%- endif -%}
        </div>

        {%- unless forloop.last -%}
          <div class="how-it-works__connector" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </div>
        {%- endunless -%}
      {%- endfor -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "How It Works",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "default": "How It Works",
      "label": "Heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        { "value": "h2", "label": "Small" },
        { "value": "h1", "label": "Medium" },
        { "value": "h0", "label": "Large" }
      ],
      "default": "h1",
      "label": "Heading size"
    },
    {
      "type": "text",
      "id": "subheading",
      "default": "From photo to figurine in four simple steps",
      "label": "Subheading"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 52
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 52
    }
  ],
  "blocks": [
    {
      "type": "step",
      "name": "Step",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "default": "Step Title",
          "label": "Title"
        },
        {
          "type": "richtext",
          "id": "description",
          "default": "<p>Description of this step in the process.</p>",
          "label": "Description"
        },
        {
          "type": "header",
          "content": "Media"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "Recommended: 400x400px or larger"
        },
        {
          "type": "url",
          "id": "video_url",
          "label": "Video URL (MP4)",
          "info": "Use a direct link to an MP4 file. Takes priority over image if both are set."
        },
        {
          "type": "header",
          "content": "Fallback Icon"
        },
        {
          "type": "select",
          "id": "icon",
          "options": [
            { "value": "upload", "label": "Upload" },
            { "value": "design", "label": "Design/3D" },
            { "value": "print", "label": "Print" },
            { "value": "ship", "label": "Ship" },
            { "value": "check", "label": "Checkmark" }
          ],
          "default": "check",
          "label": "Icon",
          "info": "Only shown if no image or video is set"
        },
        {
          "type": "color",
          "id": "icon_color",
          "label": "Icon background color",
          "default": "#4A90D9"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "How It Works",
      "blocks": [
        {
          "type": "step",
          "settings": {
            "title": "Send Your Photos",
            "description": "<p>Share clear photos of the person or couple you want to immortalize.</p>",
            "icon": "upload",
            "icon_color": "#4A90D9"
          }
        },
        {
          "type": "step",
          "settings": {
            "title": "Review Designs",
            "description": "<p>We send you multiple 3D render options to choose from.</p>",
            "icon": "design",
            "icon_color": "#E85D75"
          }
        },
        {
          "type": "step",
          "settings": {
            "title": "We Print",
            "description": "<p>Once approved, we 3D print your figurine in-house with premium materials.</p>",
            "icon": "print",
            "icon_color": "#50C878"
          }
        },
        {
          "type": "step",
          "settings": {
            "title": "Fast Shipping",
            "description": "<p>Your finished figurine ships within 48 hours of approval.</p>",
            "icon": "ship",
            "icon_color": "#9B59B6"
          }
        }
      ]
    }
  ]
}
{% endschema %}
